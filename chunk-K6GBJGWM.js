import{a as r}from"./chunk-2UUWE3MU.js";import{Af as I,Bf as v,G as d,If as c,Mb as l,Nb as p,O as u,S as m,W as o,ca as a,de as D,p as f,q as h,rc as b,z as g}from"./chunk-B4G34RIT.js";var N=`${r.apiUrl}/app/tenants`,x=(()=>{let e=class e{constructor(){this.snackbar=o(v),this.tenantID=a(void 0),this.tenant_=a(void 0),this.tenant=l(()=>this.tenant_()),this.loading=a(!1),this.error=a(void 0),this.logoUrl=l(()=>this.tenant()&&`${r.filesUrl}tenants/${this.tenant().id}/logo.png?v=3`),this.http=o(b),this.logger=o(I),p(()=>{this.error()&&this.snackbar.error({title:"\u05E9\u05D2\u05D9\u05D0\u05D4",msg:this.error(),btn:"\u05E1\u05D2\u05D5\u05E8",duration:1e4})}),D([this.tenantID],([t])=>{this.tenant_.set(void 0),this.loading.set(!0),t&&this.refresh().pipe(d(()=>this.loading.set(!1)),g(n=>(this.error.set(n),this.tenantID.set(void 0),h(()=>n)))).subscribe()})}determineTenant(){if(r.tenant){this.logger.debug("TenantService: DEBUG mode; use tenant from ENV:",r.tenant),this.tenantID.set(r.tenant);return}let t=localStorage.getItem("tenant");if(t&&!isNaN(+t)){this.logger.debug("TenantService: found tenant in local storage",t),this.tenantID.set(+t);return}let n=location.hostname;this.logger.debug("TenantService: locate tenant by hostname:",n),this.loading.set(!0),this.http.get(`${N}/by-host`,{context:c()}).pipe(d(()=>this.loading.set(!1)),g(i=>(this.error.set(i),h(()=>i)))).subscribe(i=>{this.logger.debug("TenantService: found tenant by hostname:",i),localStorage.setItem("tenant",i.toString()),this.tenantID.set(i)})}refresh(){return this.tenantID()?this.http.get(`${N}/${this.tenantID()}`,{context:c()}).pipe(u(t=>{this.tenant_.set(t)})):f(void 0)}addTenantToHttpRequest(t){return this.tenantID()?t.clone({setHeaders:{tenant:""+this.tenantID().toString()}}):t}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=m({token:e,factory:e.\u0275fac,providedIn:"root"});let s=e;return s})();export{x as a};
