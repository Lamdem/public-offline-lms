import{a as i}from"./chunk-2UUWE3MU.js";import{Af as I,Bf as S,G as d,If as g,Mb as a,Nb as v,O as p,S as h,W as l,ca as o,ee as D,p as m,q as c,rc as b,z as f}from"./chunk-SYGYQDC7.js";var U=(()=>{let e=class e{constructor(){this._localServer=o(null),this._schoolUid=o(null),this.localServer=this._localServer.asReadonly(),this.schoolUid=this._schoolUid.asReadonly(),this.isOfflineMode=a(()=>i.offline&&!!this._localServer()?.length),this.envFilesUrl=a(()=>this.isOfflineMode()?this.transformUrl(i.filesUrl):i.filesUrl),i.offline&&(this._localServer.set(localStorage.getItem("_offline-local-server")),this._schoolUid.set(localStorage.getItem("_offline-school")))}transformUrl(t){if(!this.isOfflineMode())return t;let n=/^https?:\/\/([^\/]+)(\/.*)?$/,r=t.match(n);if(!r)return t;let u=r[1],M=r[2]||"";return u===this._localServer()?t:`${this._localServer()}/proxy/${u}${M}`}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"});let s=e;return s})();var N=`${i.apiUrl}/app/tenants`,H=(()=>{let e=class e{constructor(){this.snackbar=l(S),this.envFilesUrl=l(U).envFilesUrl,this.tenantID=o(void 0),this.tenant_=o(void 0),this.tenant=a(()=>this.tenant_()),this.loading=o(!1),this.error=o(void 0),this.logoUrl=a(()=>this.tenant()&&`${this.envFilesUrl()}tenants/${this.tenant().id}/logo.png?v=3`),this.http=l(b),this.logger=l(I),v(()=>{this.error()&&this.snackbar.error({title:"\u05E9\u05D2\u05D9\u05D0\u05D4",msg:this.error(),btn:"\u05E1\u05D2\u05D5\u05E8",duration:1e4})}),D([this.tenantID],([t])=>{this.tenant_.set(void 0),this.loading.set(!0),t&&this.refresh().pipe(d(()=>this.loading.set(!1)),f(n=>(this.error.set(n),this.tenantID.set(void 0),c(()=>n)))).subscribe()})}determineTenant(){if(i.tenant){this.logger.debug("TenantService: DEBUG mode; use tenant from ENV:",i.tenant),this.tenantID.set(i.tenant);return}let t=localStorage.getItem("tenant");if(t&&!isNaN(+t)){this.logger.debug("TenantService: found tenant in local storage",t),this.tenantID.set(+t);return}let n=location.hostname;this.logger.debug("TenantService: locate tenant by hostname:",n),this.loading.set(!0),this.http.get(`${N}/by-host`,{context:g()}).pipe(d(()=>this.loading.set(!1)),f(r=>(this.error.set(r),c(()=>r)))).subscribe(r=>{this.logger.debug("TenantService: found tenant by hostname:",r),localStorage.setItem("tenant",r.toString()),this.tenantID.set(r)})}refresh(){return this.tenantID()?this.http.get(`${N}/${this.tenantID()}`,{context:g()}).pipe(p(t=>{this.tenant_.set(t)})):m(void 0)}addTenantToHttpRequest(t){return this.tenantID()?t.clone({setHeaders:{tenant:""+this.tenantID().toString()}}):t}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"});let s=e;return s})();export{U as a,H as b};
